{% extends "home.html" %}

{% block extra_ga %}
    {% if form.is_valid %}
        _gaq.push(['_trackEvent', 'click', 'heatmap', 'address', $('#{{ form.text.auto_id }}').val()]);
    {% endif %}
{% endblock %}

{% block output %}
    {% if form.is_valid %}
    {% if lat and lng %}
        <div id="img-block" class="span2">
            <img src="http://maps.google.com/maps/api/staticmap?center={{ lat }},{{ lng }}&markers={{ lat }},{{ lng }}&zoom=16&size=200x200&sensor=false" />
        </div>
        <div class="span8">
            <h4 id="place-block">{{ place }}</h4>
            <div>
                {% include "_chance.html" %}
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <h5>Tickets ({{ tickets_heatmap_count }})</h5>
                    <table class="table table-slim table-bordered" id="tickets-heatmap">
                        {% with tickets_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                    </table>
                </div>
                <div class="span6">
                    <h5>Patrols ({{ paths_heatmap_count }})</h5>
                    <table class="table table-slim table-bordered" id="paths-heatmap">
                        {% with paths_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                    </table>
                </div>
            </div>
        </div>
        <script>
        var heatmap_options = {
            colorArray : [
                "#63BE7B",
                "#FBE983",
                "#F8696B"
            ],
            nullColor: "#63BE7B",
            readValue : function(e) {
                return e[0].childNodes[0].text
            }
        }
            $("#tickets-heatmap td").hottie(heatmap_options);
            $("#tickets-heatmap th.column-total").hottie(heatmap_options);
            $("#tickets-heatmap th.row-total").hottie(heatmap_options);

            $("#paths-heatmap td").hottie(heatmap_options);
            $("#paths-heatmap th.column-total").hottie(heatmap_options);
            $("#paths-heatmap th.row-total").hottie(heatmap_options);

        </script>
    {% else %}
        Sorry, we cannot find coordinates of this address.
    {% endif %}
    {% endif %}
{% endblock %}