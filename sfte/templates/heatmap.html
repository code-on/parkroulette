{% extends "home.html" %}
{% block extra_ga %}
{% if form.is_valid %}  _gaq.push(['_trackEvent', 'search-address', 'heatmap', '{{ data.address }}']);
{% endif %}
{% endblock %}

{% block output %}

<div class="row-fluid" id="output-block">
	 {% if form.is_valid %} {% if data.lat and data.lng %}
	<div id="img-block" class="span6">
	</div>
	<div class="span6">
		<h4 id="place-block">{{ data.place }}</h4>
		<div id="output-text">
			 {% include "_chance.html" %}
		</div>
		<div id="block-share">
			</br>
			<strong>Share:</strong>
			<div>
				<span id='share-middle-text'>I just found out that the chance of getting a parking ticket at {{ data.place }} is {{ data.chance|floatformat:1 }}% per hour.
                    Try it out for any address in San Francisco.</span>
			</div>
			<div class="span3" id="middle-share">
				<a href="https://www.facebook.com" onclick="fb_top('fb-middle-link','#share-middle-text')" id="fb-middle-link" target="_blank">
				<img src="/static/img/btn_facebook.png"></a>
				<a href="https://twitter.com/" onclick="twitter_top('tweeter-middle-link','#share-middle-text')" id="tweeter-middle-link" target="_blank">
				<img src="/static/img/btn_twitter.png"></a>
				<a href="https://plus.google.com" onclick="googleone_top('googleone-middle-link')" id="googleone-middle-link" target="_blank">
				<img src="/static/img/btn_google_plusone.png"></a>
			</div>
		</div>
	</div>
</div>
         <div class="row-fluid tabbable" id="output-table">

             <ul class="nav nav-tabs">
                 <li class="active"><a href="#tab1" data-toggle="tab"><h5>Patrols ({{ data.paths_heatmap_count }})</h5>
                 </a></li>
                 <li><a href="#tab2" data-toggle="tab"><h5>Tickets ({{ data.tickets_heatmap_count }})</h5></a></li>
             </ul>

             <div class="tab-content">
                 <div class="tab-pane active" id="tab1">
                     <table class="table table-slim table-bordered table-condensed" id="paths-heatmap">
                         {% with data.paths_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                         {% if data.chance %}{% load humanize %}
                             <caption>
                                 <div class="row">
                                     <div class="span7">
                                         Patrols within {{ data.get_distance_display }} of {{ data.place }}
                                         over {{ data.hours_count|intcomma }} hours in 2012
                                     </div>
                                     <div class='legend span5'>
                                         <div class='legend-scale pull-right'>
                                             <ul class='legend-labels'>
                                                 {% for l in data.paths_heatmap_legend %}
                                                     <li><span></span>{{ l }}</li>
                                                 {% endfor %}
                                             </ul>
                                         </div>
                                     </div>
                                 </div>
                             </caption>
                         {% endif %}
                     </table>
                 </div>
                 <div class="tab-pane" id="tab2">
                     <table class="table table-slim table-bordered" id="tickets-heatmap">
                         {% with data.tickets_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                         {% if data.chance %}{% load humanize %}
                             <caption>Tickets within {{ data.get_distance_display }} of {{ data.place }}
                                 over {{ data.hours_count|intcomma }} hours in 2011 and 2012
                             </caption>
                         {% endif %}
                     </table>
                 </div>
             </div>
         </div>
         <script>
             var date = new Date;
             var weekday = new Array(7);
             weekday[0] = "SUN";
             weekday[1] = "MON";
             weekday[2] = "TUE";
             weekday[3] = "WED";
             weekday[4] = "THU";
             weekday[5] = "FRI";
             weekday[6] = "SAT";
             var dayOfWeek = weekday[date.getUTCDay()];
             var H = date.getHours()
             var h = H % 12 || 12;
             var ampm = H < 12 ? "AM" : "PM";
             var time = h + ampm;
             $('.table thead th').each(function() {
                 if ($(this).html() == dayOfWeek || $(this).children("a").html() == dayOfWeek){
                    $(this).attr('class', 'day');
                 }

             });
             $('.stats-title').each(function() {
                 if ($(this).html() == time || $(this).children("a").html() == time){
                    $(this).parent('tr').attr('class', 'hour');
                 }

             });
             $('.day' ).each(function() {
                 var column = $(this).index()-1;
                 $('.hour' ).each(function() {
                     var cell = $(this).find('td').eq(column);
                     cell.attr('class', 'time-now');
                 });
               });
             var heatmap_options = {
                 colorArray: [
                     "#63BE7B",
                     "#FBE983",
                     "#F8696B"
                 ],
                 nullColor: "#63BE7B",
                 readValue: function (e) {
                     return ($(e).children("a").html())
                 }
             }
             $("#tickets-heatmap td").hottie(heatmap_options);
             $("#tickets-heatmap th.column-total").hottie(heatmap_options);
             $("#tickets-heatmap th.row-total").hottie(heatmap_options);
             heatmap_options = {
                 colorArray: [
                     "#63BE7B",
                     "#FBE983",
                     "#F8696B"
                 ],
                 nullColor: "#63BE7B",
                 readValue: function (e) {
                     return ($(e).html())
                 }
             }
             $("#paths-heatmap td").hottie(heatmap_options);
             $("#paths-heatmap th.column-total").hottie(heatmap_options);
             $("#paths-heatmap th.row-total").hottie(heatmap_options);
             $(".legend-labels span").hottie({
                 colorArray: [
                     "#63BE7B",
                     "#FBE983",
                     "#F8696B"
                 ],
                 readValue: function (e) {
                     return ($(e).parent('li').text())
                 }
             });
         </script>
 {% else %} Sorry, we cannot find coordinates of this address. {% endif %} {% endif %}
</div>

{% endblock %}