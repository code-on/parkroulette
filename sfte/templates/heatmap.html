{% extends "home.html" %}

{% block extra_ga %}
    {% if form.is_valid %}
        _gaq.push(['_trackEvent', 'click', 'heatmap', 'address', $('#{{ form.text.auto_id }}').val()]);
    {% endif %}
{% endblock %}

{% block output %}
    {% if form.is_valid %}
    {% if lat and lng %}
        <div id="img-block" class="span2">
            <img src="http://maps.google.com/maps/api/staticmap?center={{ lat }},{{ lng }}&markers={{ lat }},{{ lng }}&zoom=16&size=200x200&sensor=false" />
        </div>
        <div class="span8">
            <h4 id="place-block">{{ place }}</h4>
            <div>
                {% include "_chance.html" %}
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <h5>Tickets ({{ tickets_count }})</h5>
                    <table class="table table-slim table-bordered" id="tickets-heatmap">
                        {% with tickets_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                    </table>
                </div>
                <div class="span6">
                    <h5>Patrols ({{ paths_count }})</h5>
                    <table class="table table-slim table-bordered" id="paths-heatmap">
                        {% with paths_heatmap as heatmap %}{% include "_heatmap.html" %}{% endwith %}
                    </table>
                </div>
            </div>
        </div>
        <script>
            $("#tickets-heatmap td").hottie({
                colorArray : [
                    "#63BE7B",
                    "#FBE983",
                    "#F8696B"
                ]
            });

            $("#paths-heatmap td").hottie({
                colorArray : [
                    "#63BE7B",
                    "#FBE983",
                    "#F8696B"
                ]
            });
        </script>
    {% else %}
        Sorry, we cannot find coordinates of this address.
    {% endif %}
    {% endif %}
{% endblock %}